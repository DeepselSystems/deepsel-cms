---
import {
  fetchPageData,
  parseSlug,
  fetchBlogList,
  fetchBlogPost,
  type PageData,
  type BlogListData,
  type BlogPostData,
} from "@deepsel/cms-utils";
import {
  getPageThemeComponent,
  getBlogListThemeComponent,
  getBlogPostThemeComponent,
} from "../utils/getThemeComponent";

const { slug = "/" } = Astro.params;
const { lang, path, pathType, pagination } = parseSlug(slug);

let ThemeComponent: any;
let pageData: PageData | null = null;
let blogListData: BlogListData | null = null;
let blogPostData: BlogPostData | null = null;

if (pathType === "Page") {
  pageData = await fetchPageData(path, lang, Astro.request);
  ThemeComponent = getPageThemeComponent(pageData, lang);
} else if (pathType === "BlogList") {
  blogListData = await fetchBlogList(Astro.request, pagination, lang);
  ThemeComponent = getBlogListThemeComponent(blogListData, lang);
} else if (pathType === "BlogPost") {
  blogPostData = await fetchBlogPost(path, lang, Astro.request);
  ThemeComponent = getBlogPostThemeComponent(blogPostData, lang);
} else {
  pageData = await fetchPageData(path, lang, Astro.request);
  ThemeComponent = getPageThemeComponent(pageData, lang);
}
---

{
  pathType === "Page" ? (
    <ThemeComponent data={pageData} />
  ) : pathType === "BlogList" ? (
    <ThemeComponent data={blogListData} />
  ) : // :(pathType === "BlogPost") ? <ThemeComponent data={blogPostData} />
  null
}
