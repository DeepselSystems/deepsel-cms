---
import {
  fetchPageData,
  parseSlug,
  fetchBlogList,
  fetchBlogPost,
  type PageData,
  type BlogListData,
  type BlogPostData,
} from "@deepsel/cms-utils";
import {
  getPageThemeComponent,
  getBlogListThemeComponent,
  getBlogPostThemeComponent,
} from "../utils/getThemeComponent";

const { slug = "/" } = Astro.params;
const { lang, path, pathType, pagination } = parseSlug(slug);

let ThemeComponent: any;
let data: PageData | BlogListData | BlogPostData;

if (pathType === "Page") {
  data = await fetchPageData(path, lang, Astro.request);
  ThemeComponent = getPageThemeComponent(data, lang);
} else if (pathType === "BlogList") {
  data = await fetchBlogList(Astro.request, pagination, lang);
  ThemeComponent = getBlogListThemeComponent(data, lang);
} else if (pathType === "BlogPost") {
  data = await fetchBlogPost(path, lang, Astro.request);
  ThemeComponent = getBlogPostThemeComponent(data, lang);
} else {
  data = await fetchPageData(path, lang, Astro.request);
  ThemeComponent = getPageThemeComponent(data, lang);
}
---

{
  pathType === "Page" ? (
    <ThemeComponent data={data as PageData} />
  ) : pathType === "BlogList" ? (
    <ThemeComponent data={data as BlogListData} />
  ) : // :(pathType === "BlogPost") ? <ThemeComponent data={data as BlogPostData} />
  null
}
